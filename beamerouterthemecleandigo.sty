\ProvidesPackage{beamerouterthemecleandigo}[Cleandigo outer theme]
\mode<presentation>
\makeatletter
\usetikzlibrary{shadows}

% BEAMER FLAGS
\newif\ifbeamer@nosection
\beamer@nosectionfalse

% CALCULATE HEIGHT FOR GRAPHICS
\newlength{\graphicht}
\AtBeginEnvironment{figure}{%
	\setlength{\graphicht}{
		\textheight-
		\baselineskip-
		\parskip-
		\abovecaptionskip-
		\belowcaptionskip
	}%
	% Foot height is 8mm and head height is 12mm, the circle is 4mm
	\ifbeamer@plainframe\else%
		\ifbeamer@nosection
			\addtolength{\graphicht}{-\beamer@rightmargin}
		\else
			\addtolength{\graphicht}{-1.8\beamer@rightmargin}
		\fi
	\fi%
}

% No sidebar
\setbeamersize{sidebar width left=0pt}

% Default frame title is none
\providecommand{\insertframetitle}{}
\providecommand{\insertframesubtitle}{}


\defbeamertemplate*{frametitle}{cleandigo}{%
	\ifbeamer@plainframe\relax\else%
		\newcommand{\lm}{\beamer@leftmargin}% lEFT mARGIN
		\newcommand{\rmar}{\beamer@rightmargin}% lEFT mARGIN
		\sbox0{\insertframetitle}%
		\nointerlineskip%
		\begin{beamercolorbox}[wd=\paperwidth, ht=\rmar]{frametitle}%
			\begin{tikzpicture}[overlay]
				\usebeamerfont{frametitle}%
				\usebeamercolor{frametitle}%
				\fill[bg] (0, 0) rectangle (\paperwidth, \rmar) {};
				%\fill[white] (0, 6mm) rectangle (\paperwidth, 6.1mm) {};
				\node[inner sep=0pt, anchor=west, align=left] at (\beamer@leftmargin, 0.5\rmar) {\insertframetitle};
			\end{tikzpicture}%
		\end{beamercolorbox}%
		% NUMBERING
		\ifbeamer@noframenumbering\else%
			\begin{tikzpicture}[remember picture,overlay,every shadow/.style={shadow xshift=0ex, shadow yshift=-0.1ex, opacity=.7,fill=md-black}]
				\usebeamercolor{page number in head/foot}%
				\usebeamerfont{page number in head/foot}%
				\node[
					drop shadow,
					circle,
					fill=bg,
					xshift=-\beamer@rightmargin,
					yshift=-\beamer@rightmargin,
				] at (current page.north east){%
					\textcolor{fg}{\insertframenumber/\inserttotalframenumber}};
			\end{tikzpicture}%
		\fi
	\fi%
}


\newcommand{\insertsectionformat}{%
	\ifx\insertsection\empty\else%
		\insertsectionnumber%
		\ifx\insertsubsection\empty\else%
			.\insertsubsectionnumber%
		\fi%
		\hspace{0.5em}%
		\insertsection%
		\ifx\insertsubsection\empty\else%
			\hspace{0.5ex}\textbullet\hspace{0.5ex}%
			\insertsubsection%
		\fi%
	\fi%
}

\defbeamertemplate*{footline}{cleandigo}{%
	\ifbeamer@plainframe\relax\else%
		\ifbeamer@nosection%
            \global\beamer@nosectionfalse%
        \else%
			\nointerlineskip%
			\begin{beamercolorbox}[
					wd=\paperwidth,
					ht=0.8\beamer@rightmargin,
				]{section in head/foot}%
				\begin{tikzpicture}[overlay]
					\usebeamerfont{section in head/foot}
					\usebeamercolor{section in head/foot}
					%\fill[white] (0, 6mm) rectangle (\paperwidth, 6.1mm) {};
					\node[inner sep=0pt, anchor=west, align=left] at (\beamer@leftmargin, 0.4\beamer@rightmargin ) {\insertsectionformat};
				\end{tikzpicture}%
			\end{beamercolorbox}
		\fi%
	\fi%
}

% CUSTOM KEY
\define@key{beamerframe}{nosection}[true]{%
	\beamer@nosectiontrue
}

\makeatother
\mode<all>
